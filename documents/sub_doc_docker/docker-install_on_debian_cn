在Debian上安装Docker Engine

我的总结：
# 步骤1: 添加Docker的官方GPG密钥:
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# 步骤2: 将仓库添加到Apt源:
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update

# 步骤3: 要安装最新版本，运行:
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 步骤4:
sudo docker run hello-world


细节：<https://docs.docker.com/engine/install/debian/>

要在 Debian 上开始使用 Docker Engine，请确保满足先决条件，然后按照安装步骤进行操作。
先决条件{
防火墙限制
    警告

    在安装 Docker 之前，请确保考虑以下安全隐患和防火墙不兼容性。

    如果您使用 ufw 或 firewalld 管理防火墙设置，请注意，当您使用 Docker 暴露容器端口时，这些端口会绕过您的防火墙规则。有关更多信息，请参阅 Docker 和 ufw。
    Docker 仅兼容 iptables-nft 和 iptables-legacy。在安装了 Docker 的系统上，不支持使用 nft 创建的防火墙规则。确保您使用的任何防火墙规则集都是使用 iptables 或 ip6tables 创建的，并将它们添加到 DOCKER-USER 链中，请参阅 数据包过滤和防火墙。
}

操作系统要求{

要安装 Docker Engine，您需要以下 Debian 版本之一的 64 位版本：
    Debian Trixie 13 (测试版)
    Debian Bookworm 12 (稳定版)
    Debian Bullseye 11 (旧稳定版)
Debian 的 Docker Engine 与 x86_64（或 amd64）、armhf、arm64 和 ppc64le（ppc64el）架构兼容。
}

卸载旧版本{

在安装 Docker Engine 之前，您需要卸载所有有冲突的软件包。

您的 Linux 发行版可能提供了非官方的 Docker 软件包，这些软件包可能会与 Docker 提供的官方软件包冲突。您必须在安装 Docker Engine 正式版之前卸载这些软件包。

要卸载的非官方软件包包括：

    docker.io
    docker-compose
    docker-doc
    podman-docker

此外，Docker Engine 依赖于 containerd 和 runc。Docker Engine 将这些依赖项打包在一起：containerd.io。如果您之前安装了 containerd 或 runc，请卸载它们，以避免与 Docker Engine 捆绑的版本发生冲突。

运行以下命令卸载所有冲突的软件包：

 for pkg in docker.io docker-doc docker-compose podman-docker containerd runc; do sudo apt-get remove $pkg; done

apt-get 可能会报告您没有安装这些软件包。

存储在 /var/lib/docker/ 中的镜像、容器、卷和网络在卸载 Docker 时不会自动删除。如果您想从干净的安装开始，并希望清理任何现有数据，请阅读卸载 Docker Engine 部分。
}

安装方法{

您可以根据需要通过不同的方式安装 Docker Engine：

    Docker Engine 与 Linux 版 Docker Desktop 捆绑在一起。这是最简单、最快捷的入门方式。

    从 Docker 的 apt 存储库设置并安装 Docker Engine。

    手动安装并手动管理升级。

    使用便捷脚本。仅推荐用于测试和开发环境。

使用 apt 存储库安装

在新的主机上首次安装 Docker Engine 之前，您需要设置 Docker apt 存储库。之后，您可以从存储库安装和更新 Docker。

1,设置 Docker 的 apt 镜像库。

# 添加Docker的官方GPG密钥：
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# 将镜像库添加到 Apt 源：
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update

注意
如果您使用衍生发行版（例如 Kali Linux），则可能需要替换此命令中预期打印版本代号的部分：
    (. /etc/os-release && echo "$VERSION_CODENAME")
    将此部分替换为相应 Debian 版本的代号，例如 bookworm。

2,安装 Docker 软件包

要安装最新版本，请运行：

 sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

3,通过运行hello-world镜像来验证安装是否成功：

 sudo docker run hello-world

此命令下载测试映像并在容器中运行它。容器运行时，它会打印一条确认消息并退出。

您现在已成功安装并启动 Docker Engine。

    提示
    尝试以非 root 身份运行时出现错误？
    docker 用户组存在但不包含任何用户，这就是为什么您需要使用 sudo 来运行 Docker 命令。
    sudo usermod -aG docker $USER
}

升级 Docker 引擎{
要升级 Docker Engine，请按照安装说明的第 2 步进行操作，选择要安装的新版本。

}

从包中安装{

如果您不能使用 Docker 的 apt 存储库安装 Docker Engine，您可以下载适合您发行版的 deb 文件并手动安装。每次要升级 Docker Engine 时，您都需要下载新文件。

    访问 https://download.docker.com/linux/debian/dists/

。

在列表中选择您的 Debian 版本。

进入 pool/stable/ 并选择适用的架构（amd64、armhf、arm64 或 s390x）。

下载以下用于 Docker Engine、CLI、containerd 和 Docker Compose 包的 deb 文件：

    containerd.io_<版本>_<架构>.deb
    docker-ce_<版本>_<架构>.deb
    docker-ce-cli_<版本>_<架构>.deb
    docker-buildx-plugin_<版本>_<架构>.deb
    docker-compose-plugin_<版本>_<架构>.deb

安装 .deb 软件包。更新以下示例中的路径到您下载 Docker 软件包的位置。

 sudo dpkg -i ./containerd.io_<版本>_<架构>.deb \
  ./docker-ce_<版本>_<架构>.deb \
  ./docker-ce-cli_<版本>_<架构>.deb \
  ./docker-buildx-plugin_<版本>_<架构>.deb \
  ./docker-compose-plugin_<版本>_<架构>.deb

Docker 守护进程会自动启动。

通过运行 hello-world 镜像验证安装是否成功：

 sudo service docker start

     sudo docker run hello-world

    此命令下载测试镜像并在容器中运行它。当容器运行时，它会打印一条确认消息并退出。

您现在已成功安装并启动 Docker Engine。
}